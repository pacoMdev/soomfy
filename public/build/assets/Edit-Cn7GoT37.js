import{a1 as ie,a2 as re,E as de,M as ue,O as ce,r as C,f as a,h as e,q as p,k as z,t as d,d as i,l as v,v as me,I as pe,N as x,F as m,m as _,a as ve,b as U,e as l,i as B}from"./app-DhgeM_ro.js";import{u as _e}from"./roles-CZUiWw_L.js";import{u as fe}from"./users-r2kQMLRw.js";import{d as F,u as ge,a as f,r as he,m as be}from"./rules-DQeMV_B6.js";const xe={class:"grid"},ye={class:"col-12 md:col-4 lg:col-4 xl:col-4"},we={class:"card mb-0"},ke={class:"card-body"},Ue={class:"account-settings"},Ve={class:"user-profile"},Se={class:"user-avatar"},Ce={class:"flex flex-wrap justify-content-between align-items-center flex-1 gap-2"},ze={class:"flex gap-2"},Be=["alt","src"],De={key:1},Ee=["alt","src"],Me=["src"],Te={key:1,src:"https://bootdey.com/img/Content/avatar/avatar7.png",alt:"Avatar Default",class:"object-fit-cover w-100 h-100 img-profile"},$e={class:"user-name"},je={class:"user-email"},Le={class:"about"},Pe={class:"form-group"},Re={class:"text-right"},Fe=["disabled"],Ne={class:""},qe={key:0},Ae={key:1},Ie={class:"col-12 md:col-8 lg:col-8 xl:col-8"},Ge={class:"card mb-3"},Ke={class:"card-body"},Oe={class:"form-group"},He={class:"text-danger mt-1"},Je={class:"text-danger mt-1"},Qe={class:"form-group"},We={class:"text-danger mt-1"},Xe={class:"text-danger mt-1"},Ye={class:"form-group"},Ze={class:"text-danger mt-1"},et={class:"text-danger mt-1"},tt={class:"form-group"},st={class:"text-danger mt-1"},ot={class:"text-danger mt-1"},at={class:"form-group"},lt={class:"text-danger mt-1"},nt={class:"text-danger mt-1"},gt={__name:"Edit",setup(it){const N=ie();re();const{roleList:q,getRoleList:A}=_e(),{updateUser:I,getUser:G,user:u,createUserDB:rt,deleteUserDB:dt,changeUserPasswordDB:ut,createUserProceduredDB:ct,validationErrors:g,isLoading:V}=fe();F("required",he),F("min",be);const K={name:"required",email:"required",password:"min:8"},{validate:O,errors:h,resetForm:mt}=ge({validationSchema:K}),{value:H}=f("name",null,{initialValue:""}),{value:J}=f("email",null,{initialValue:""}),{value:Q}=f("surname1",null,{initialValue:""}),{value:W}=f("surname2",null,{initialValue:""}),{value:X}=f("password",null,{initialValue:""}),{value:Y}=f("role_id",null,{initialValue:"",label:"role"}),s=de({name:H,email:J,surname1:Q,surname2:W,password:X,role_id:Y}),Z=ve();function ee(){O().then(n=>{n.valid&&I(s)})}ue(()=>{A(),G(Z.params.id)}),ce(()=>{s.id=u.value.id,s.name=u.value.name,s.email=u.value.email,s.surname1=u.value.surname1,s.surname2=u.value.surname2,s.role_id=u.value.role_id,s.avatar=u.value.avatar});const D=C(0),te=C(0),E=C([]),se=n=>{n.formData.append("id",s.id)},oe=n=>{console.log("onSelectedFiles"),E.value=n.files,n.files.length>1&&(n.files=n.files.splice(0,n.files.length-1)),E.value.forEach(t=>{D.value+=parseInt(ne(t.size))})},ae=async(n,t)=>{console.log("uploadEvent"),te.value=D.value/10,await n()},le=n=>{},ne=n=>{const w=N.config.locale.fileSizeTypes;if(n===0)return`0 ${w[0]}`;const k=Math.floor(Math.log(n)/Math.log(1024));return`${parseFloat((n/Math.pow(1024,k)).toFixed(3))} ${w[k]}`};return(n,t)=>{var T,$,j,L,P;const y=U("Button"),w=U("FileUpload"),k=U("MultiSelect"),M=U("Toast");return l(),a(m,null,[e("div",xe,[e("div",ye,[e("div",we,[e("div",ke,[e("div",Ue,[e("div",Ve,[e("div",Se,[p(w,{name:"picture",url:"/api/users/updateimg",onBeforeUpload:se,onUpload:t[0]||(t[0]=o=>le()),accept:"image/*",maxFileSize:15e5,onSelect:oe,"pt:content:class":"fu-content","pt:buttonbar:class":"fu-header","pt:root:class":"fu",class:"fu"},{header:z(({chooseCallback:o,uploadCallback:r,clearCallback:R,files:b,uploadedFiles:c})=>[e("div",Ce,[e("div",ze,[p(y,{onClick:S=>o(),icon:"pi pi-images",rounded:"",outlined:""},null,8,["onClick"]),p(y,{onClick:S=>ae(r,c),icon:"pi pi-cloud-upload",rounded:"",outlined:"",severity:"success",disabled:!b||b.length===0},null,8,["onClick","disabled"]),p(y,{onClick:S=>R(),icon:"pi pi-times",rounded:"",outlined:"",severity:"danger",disabled:!b||b.length===0},null,8,["onClick","disabled"])]),t[7]||(t[7]=e("p",{class:"mt-4 mb-0"},"Drag and drop files to here to upload.",-1))])]),content:z(({files:o,uploadedFiles:r,removeUploadedFileCallback:R,removeFileCallback:b})=>[o.length>0?(l(!0),a(m,{key:0},_(o,(c,S)=>(l(),a("img",{key:c.name+c.type+c.size,role:"presentation",alt:c.name,src:c.objectURL,class:"object-fit-cover w-100 h-100 img-profile"},null,8,Be))),128)):(l(),a("div",De,[r.length>0?(l(),a("img",{key:r[r.length-1].name+r[r.length-1].type+r[r.length-1].size,role:"presentation",alt:r[r.length-1].name,src:r[r.length-1].objectURL,class:"object-fit-cover w-100 h-100 img-profile"},null,8,Ee)):B("",!0)]))]),empty:z(()=>[s.avatar?(l(),a("img",{key:0,src:s.avatar,alt:"Avatar",class:"object-fit-cover w-100 h-100 img-profile"},null,8,Me)):B("",!0),s.avatar?B("",!0):(l(),a("img",Te))]),_:1})]),e("h5",$e,d(s.name),1),e("h6",je,d(s.email),1)]),e("div",Le,[e("div",Pe,[t[8]||(t[8]=e("label",{for:"roles"},"Roles",-1)),p(k,{id:"roles",modelValue:s.role_id,"onUpdate:modelValue":t[1]||(t[1]=o=>s.role_id=o),display:"chip",options:i(q),optionLabel:"name",dataKey:"id",placeholder:"Seleciona los roles",appendTo:"self",class:"w-100"},null,8,["modelValue","options"])]),e("div",Re,[e("button",{disabled:i(V),class:"btn btn-primary w-100",onClick:ee},[v(e("div",Ne,null,512),[[me,i(V)]]),i(V)?(l(),a("span",qe,"Processing...")):(l(),a("span",Ae,"Guardar"))],8,Fe)])])])])])]),e("div",Ie,[e("div",Ge,[e("div",Ke,[pe(d(s.avatar)+" ",1),t[14]||(t[14]=e("h6",{class:"mb-2 text-primary"},"Personal Details",-1)),e("div",Oe,[t[9]||(t[9]=e("label",{for:"name"},"Nombre",-1)),v(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>s.name=o),type:"text",class:"form-control",id:"name"},null,512),[[x,s.name]]),e("div",He,d(i(h).name),1),e("div",Je,[(l(!0),a(m,null,_((T=i(g))==null?void 0:T.name,o=>(l(),a("div",null,d(o),1))),256))])]),e("div",Qe,[t[10]||(t[10]=e("label",{for:"surname1"},"Apellido 1",-1)),v(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>s.surname1=o),type:"text",class:"form-control",id:"surname1"},null,512),[[x,s.surname1]]),e("div",We,d(i(h).surname1),1),e("div",Xe,[(l(!0),a(m,null,_(($=i(g))==null?void 0:$.surname1,o=>(l(),a("div",null,d(o),1))),256))])]),e("div",Ye,[t[11]||(t[11]=e("label",{for:"surname2"},"Apellido 2",-1)),v(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>s.surname2=o),type:"text",class:"form-control",id:"surname2"},null,512),[[x,s.surname2]]),e("div",Ze,d(i(h).surname2),1),e("div",et,[(l(!0),a(m,null,_((j=i(g))==null?void 0:j.surname2,o=>(l(),a("div",null,d(o),1))),256))])]),e("div",tt,[t[12]||(t[12]=e("label",{for:"email"},"Email",-1)),v(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>s.email=o),type:"email",class:"form-control",id:"email"},null,512),[[x,s.email]]),e("div",st,d(i(h).email),1),e("div",ot,[(l(!0),a(m,null,_((L=i(g))==null?void 0:L.email,o=>(l(),a("div",null,d(o),1))),256))])]),e("div",at,[t[13]||(t[13]=e("label",{for:"password"},"Password",-1)),v(e("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>s.password=o),type:"password",class:"form-control",id:"password"},null,512),[[x,s.password]]),e("div",lt,d(i(h).password),1),e("div",nt,[(l(!0),a(m,null,_((P=i(g))==null?void 0:P.password,o=>(l(),a("div",null,d(o),1))),256))])])])])])]),p(M)],64)}}};export{gt as default};
